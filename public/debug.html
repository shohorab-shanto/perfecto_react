<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport"
        content="width=device-width, initial-scale=1.0, user-scalable=no, viewport-fit=cover, shrink-to-fit=no">
    <title>Perfecto Debug - Facebook iOS Browser</title>
    <style>
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            margin: 0;
            padding: 20px;
            background-color: #f9fafb;
            color: #374151;
        }

        .container {
            max-width: 800px;
            margin: 0 auto;
            background: white;
            border-radius: 8px;
            padding: 30px;
            box-shadow: 0 1px 3px rgba(0, 0, 0, 0.1);
        }

        .header {
            text-align: center;
            margin-bottom: 30px;
        }

        .section {
            margin-bottom: 30px;
        }

        .section h2 {
            font-size: 18px;
            margin-bottom: 15px;
            color: #374151;
        }

        .test-grid {
            background-color: #f9fafb;
            padding: 15px;
            border-radius: 6px;
        }

        .test-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 8px 0;
            border-bottom: 1px solid #e5e7eb;
        }

        .test-item:last-child {
            border-bottom: none;
        }

        .test-label {
            font-size: 14px;
        }

        .test-value {
            font-size: 12px;
            font-weight: 500;
            max-width: 200px;
            text-align: right;
            word-break: break-word;
        }

        .success {
            color: #059669;
        }

        .error {
            color: #dc2626;
        }

        .neutral {
            color: #6b7280;
        }

        .button {
            background-color: #5DC9F4;
            color: white;
            padding: 10px 20px;
            border: none;
            border-radius: 4px;
            font-size: 14px;
            cursor: pointer;
            margin: 5px;
        }

        .button:hover {
            background-color: #0ea5e9;
        }

        .button-secondary {
            background-color: #6b7280;
        }

        .button-secondary:hover {
            background-color: #4b5563;
        }

        .button-danger {
            background-color: #dc2626;
        }

        .button-danger:hover {
            background-color: #b91c1c;
        }

        #loading {
            text-align: center;
            padding: 40px;
        }

        .spinner {
            width: 40px;
            height: 40px;
            border: 4px solid #e5e7eb;
            border-top: 4px solid #5DC9F4;
            border-radius: 50%;
            animation: spin 1s linear infinite;
            margin: 0 auto 20px;
        }

        @keyframes spin {
            0% {
                transform: rotate(0deg);
            }

            100% {
                transform: rotate(360deg);
            }
        }

        .error-display {
            background-color: #fef2f2;
            border: 1px solid #fecaca;
            border-radius: 6px;
            padding: 15px;
            margin-bottom: 20px;
            color: #991b1b;
            font-size: 14px;
        }

        .alert-box {
            background-color: #fef3c7;
            border: 1px solid #f59e0b;
            border-radius: 6px;
            padding: 15px;
            margin-bottom: 20px;
            color: #92400e;
            font-size: 14px;
        }

        .info-box {
            background-color: #dbeafe;
            border: 1px solid #3b82f6;
            border-radius: 6px;
            padding: 15px;
            margin-bottom: 20px;
            color: #1e40af;
            font-size: 14px;
        }

        .status-indicator {
            display: inline-block;
            width: 12px;
            height: 12px;
            border-radius: 50%;
            margin-right: 8px;
        }

        .status-good {
            background-color: #10b981;
        }

        .status-warning {
            background-color: #f59e0b;
        }

        .status-error {
            background-color: #ef4444;
        }
    </style>
</head>

<body>
    <div class="container">
        <div class="header">
            <h1>üîç Perfecto Debug Tool</h1>
            <p>Facebook iOS Browser Compatibility Test</p>

            <div id="browser-status" style="margin: 20px 0;"></div>

            <button class="button" onclick="runDiagnostics()">üîÑ Run Diagnostics</button>
            <button class="button" onclick="copyResults()">üìã Copy Results</button>
            <button class="button-danger" onclick="testNodeAPI()">üåê Test Node API</button>
        </div>

        <div id="loading" style="display: none;">
            <div class="spinner"></div>
            <p>Running diagnostics...</p>
        </div>

        <div id="error-display" style="display: none;" class="error-display">
            <strong>Error running diagnostics:</strong>
            <div id="error-message"></div>
        </div>

        <div id="node-api-status" style="display: none;"></div>

        <div id="results" style="display: none;">
            <!-- Browser Info -->
            <div class="section">
                <h2>üì± Browser Information</h2>
                <div class="test-grid" id="browser-info"></div>
            </div>

            <!-- API Tests -->
            <div class="section">
                <h2>üîß Browser API Support</h2>
                <div class="test-grid" id="api-tests"></div>
            </div>

            <!-- Storage Tests -->
            <div class="section">
                <h2>üíæ Storage Support</h2>
                <div class="test-grid" id="storage-tests"></div>
            </div>

            <!-- Network Tests -->
            <div class="section">
                <h2>üåê Network Connectivity</h2>
                <div class="test-grid" id="network-tests"></div>
            </div>
        </div>

        <div style="text-align: center; padding-top: 20px;">
            <button class="button button-secondary" onclick="window.location.href='/'">üè† Back to Home</button>
            <button class="button" onclick="window.location.reload()">üîÑ Refresh</button>
            <button class="button button-secondary" onclick="window.open('https://perfectobd.com', '_blank')">üåê Open in
                Browser</button>
        </div>
    </div>

    <script>
        let diagnosticResults = {};

        // Enhanced browser detection
        function detectBrowserEnvironment() {
            const userAgent = navigator.userAgent || '';
            const isFacebook = /FBAN|FBAV|Instagram|FB_IAB|FB4A|FBIOS|FBANDROID/.test(userAgent);
            const isIOS = /iPad|iPhone|iPod/.test(navigator.userAgent);
            const isAndroid = /Android/.test(userAgent);

            let status = '';
            let statusClass = '';

            if (isFacebook && isIOS) {
                status = '‚ö†Ô∏è Facebook iOS Browser Detected - Known Issues with Node API';
                statusClass = 'alert-box';
            } else if (isFacebook && isAndroid) {
                status = '‚ö†Ô∏è Facebook Android Browser Detected';
                statusClass = 'alert-box';
            } else if (isFacebook) {
                status = '‚ö†Ô∏è Facebook Browser Detected';
                statusClass = 'alert-box';
            } else {
                status = '‚úÖ Regular Browser - Should Work Normally';
                statusClass = 'info-box';
            }

            document.getElementById('browser-status').innerHTML = `<div class="${statusClass}">${status}</div>`;
            return { isFacebook, isIOS, isAndroid };
        }

        // Test Node API specifically
        async function testNodeAPI() {
            const statusDiv = document.getElementById('node-api-status');
            statusDiv.style.display = 'block';
            statusDiv.innerHTML = '<div class="info-box">üîÑ Testing Node API connectivity...</div>';

            const nodeEndpoints = [
                'https://node.perfectobd.com/api/node/get-home-web',
                'https://node.perfectobd.com/api/node/brand',
                'https://node.perfectobd.com/api/node/color',
                'https://node.perfectobd.com/api/node/get-available-offers'
            ];

            let results = [];

            for (const endpoint of nodeEndpoints) {
                try {
                    // Use the same test method as main diagnostic for consistency
                    const response = await fetch(endpoint, {
                        method: 'GET',
                        timeout: 8000,
                        signal: AbortSignal.timeout(8000)
                    });

                    results.push({
                        endpoint: endpoint.split('/').pop(),
                        status: response.ok ? 'success' : `failed (${response.status})`,
                        ok: response.ok
                    });
                } catch (error) {
                    results.push({
                        endpoint: endpoint.split('/').pop(),
                        status: `failed: ${error.message}`,
                        ok: false
                    });
                }
            }

            const failedCount = results.filter(r => !r.ok).length;
            const successCount = results.filter(r => r.ok).length;

            let statusHtml = '';
            if (failedCount > 0) {
                statusHtml += `<div class="error-display">
                    <strong>‚ùå Node API Issues Detected (${failedCount}/${results.length} failed)</strong>
                    <p>This is the cause of the white screen issue in Facebook's browser.</p>
                    <p><strong>Root Cause:</strong> Facebook iOS browser blocks Node API calls (node.perfectobd.com)</p>
                    <ul>`;

                results.forEach(result => {
                    const icon = result.ok ? '‚úÖ' : '‚ùå';
                    statusHtml += `<li>${icon} ${result.endpoint}: ${result.status}</li>`;
                });

                statusHtml += `</ul>
                    <p><strong>Our Solution:</strong> The app now has fallback mechanisms to handle this gracefully.</p>
                    <p><strong>User Action:</strong> Use "Open in Browser" for the best experience, or the app will work with limited content.</p>
                </div>`;
            } else {
                statusHtml += `<div class="info-box">
                    <strong>‚úÖ Node API Working (${successCount}/${results.length} successful)</strong>
                    <p>All Node API endpoints are accessible. This is unexpected for Facebook iOS browser!</p>
                    <p><em>Note: Node API access can be intermittent in Facebook browser.</em></p>
                </div>`;
            }

            statusDiv.innerHTML = statusHtml;
        }

        function showLoading() {
            document.getElementById('loading').style.display = 'block';
            document.getElementById('results').style.display = 'none';
            document.getElementById('error-display').style.display = 'none';
        }

        function showResults() {
            document.getElementById('loading').style.display = 'none';
            document.getElementById('results').style.display = 'block';
            document.getElementById('error-display').style.display = 'none';
        }

        function showError(message) {
            document.getElementById('loading').style.display = 'none';
            document.getElementById('error-display').style.display = 'block';
            document.getElementById('error-message').textContent = message;
        }

        function addTestResult(containerId, label, value, isGood = null) {
            const container = document.getElementById(containerId);
            const item = document.createElement('div');
            item.className = 'test-item';

            let valueClass = 'neutral';
            let displayValue = value;
            let statusIcon = '';

            if (typeof value === 'boolean') {
                displayValue = value ? 'Available' : 'Missing';
                valueClass = value ? 'success' : 'error';
                statusIcon = value ? '<span class="status-indicator status-good"></span>' : '<span class="status-indicator status-error"></span>';
            } else if (isGood === true) {
                valueClass = 'success';
                statusIcon = '<span class="status-indicator status-good"></span>';
            } else if (isGood === false) {
                valueClass = 'error';
                statusIcon = '<span class="status-indicator status-error"></span>';
            } else {
                statusIcon = '<span class="status-indicator status-warning"></span>';
            }

            item.innerHTML = `
                <span class="test-label">${statusIcon}${label}</span>
                <span class="test-value ${valueClass}">${displayValue}</span>
            `;

            container.appendChild(item);
        }

        async function runDiagnostics() {
            showLoading();

            try {
                // Clear previous results
                ['browser-info', 'api-tests', 'storage-tests', 'network-tests'].forEach(id => {
                    document.getElementById(id).innerHTML = '';
                });

                const { isFacebook, isIOS, isAndroid } = detectBrowserEnvironment();

                // Browser Detection
                const browserInfo = {
                    userAgent: navigator.userAgent,
                    isFacebookBrowser: isFacebook,
                    isIOS: isIOS,
                    isAndroid: isAndroid,
                    viewport: `${window.innerWidth}x${window.innerHeight}`,
                    devicePixelRatio: window.devicePixelRatio,
                    language: navigator.language,
                    platform: navigator.platform,
                    cookieEnabled: navigator.cookieEnabled,
                    onLine: navigator.onLine
                };

                // API Tests
                const apiTests = {
                    ResizeObserver: !!window.ResizeObserver,
                    IntersectionObserver: !!window.IntersectionObserver,
                    MutationObserver: !!window.MutationObserver,
                    PerformanceObserver: !!window.PerformanceObserver,
                    RequestAnimationFrame: !!window.requestAnimationFrame,
                    WebComponents: !!window.customElements,
                    Proxy: typeof Proxy !== 'undefined',
                    Promise: typeof Promise !== 'undefined',
                    Fetch: typeof fetch !== 'undefined',
                    WebGL: !!window.WebGLRenderingContext,
                    ServiceWorker: 'serviceWorker' in navigator,
                    PushManager: 'PushManager' in window
                };

                // Storage Tests
                const storageTests = {
                    localStorage: (() => {
                        try {
                            localStorage.setItem('test', 'test');
                            localStorage.removeItem('test');
                            return true;
                        } catch (e) {
                            return false;
                        }
                    })(),
                    sessionStorage: (() => {
                        try {
                            sessionStorage.setItem('test', 'test');
                            sessionStorage.removeItem('test');
                            return true;
                        } catch (e) {
                            return false;
                        }
                    })(),
                    indexedDB: !!window.indexedDB,
                    cacheAPI: 'caches' in window
                };

                // Populate browser info
                Object.entries(browserInfo).forEach(([key, value]) => {
                    const label = key.replace(/([A-Z])/g, ' $1').replace(/^./, str => str.toUpperCase());
                    const isGood = key === 'isFacebookBrowser' || key === 'isIOS' ? (value ? null : true) : null;
                    addTestResult('browser-info', label, value, isGood);
                });

                // Populate API tests
                Object.entries(apiTests).forEach(([key, value]) => {
                    const label = key.replace(/([A-Z])/g, ' $1');
                    addTestResult('api-tests', label, value, value);
                });

                // Populate storage tests
                Object.entries(storageTests).forEach(([key, value]) => {
                    const label = key.replace(/([A-Z])/g, ' $1').replace(/API$/, ' API');
                    addTestResult('storage-tests', label, value, value);
                });

                // Network Tests - Use more reliable testing method
                const networkTests = {};

                try {
                    const response = await fetch('https://app.perfectobd.com/api/', {
                        method: 'GET',
                        cache: 'no-cache',
                        signal: AbortSignal.timeout(8000)
                    });
                    networkTests.mainAPIConnection = 'success';
                } catch (error) {
                    networkTests.mainAPIConnection = `failed: ${error.message}`;
                }

                try {
                    // Test Node API with same method as dedicated test
                    const response = await fetch('https://node.perfectobd.com/api/node/get-home-web', {
                        method: 'GET',
                        cache: 'no-cache',
                        signal: AbortSignal.timeout(8000)
                    });
                    networkTests.nodeAPIConnection = response.ok ? 'success' : `failed (${response.status})`;
                } catch (error) {
                    networkTests.nodeAPIConnection = `failed: ${error.message}`;
                }

                // Populate network tests
                Object.entries(networkTests).forEach(([key, value]) => {
                    const label = key.replace(/([A-Z])/g, ' $1').replace(/([a-z])([A-Z])/g, '$1 $2');
                    addTestResult('network-tests', label, value, value === 'success');
                });

                diagnosticResults = {
                    browserInfo,
                    apiTests,
                    storageTests,
                    networkTests,
                    timestamp: new Date().toISOString(),
                    environmentDetection: { isFacebook, isIOS, isAndroid }
                };

                showResults();

                // Auto-trigger Node API test if we detect issues
                if (isFacebook && isIOS && networkTests.nodeAPIConnection !== 'success') {
                    setTimeout(() => testNodeAPI(), 1000);
                }

            } catch (error) {
                console.error('Error running diagnostics:', error);
                showError(error.message);
            }
        }

        function copyResults() {
            if (Object.keys(diagnosticResults).length === 0) {
                alert('Please run diagnostics first');
                return;
            }

            const results = JSON.stringify(diagnosticResults, null, 2);

            if (navigator.clipboard) {
                navigator.clipboard.writeText(results)
                    .then(() => alert('üìã Diagnostic results copied to clipboard!'))
                    .catch(() => {
                        fallbackCopy(results);
                    });
            } else {
                fallbackCopy(results);
            }
        }

        function fallbackCopy(text) {
            const textArea = document.createElement('textarea');
            textArea.value = text;
            textArea.style.position = 'fixed';
            textArea.style.opacity = '0';
            document.body.appendChild(textArea);
            textArea.select();

            try {
                document.execCommand('copy');
                alert('üìã Diagnostic results copied to clipboard!');
            } catch (err) {
                alert('Failed to copy results. Please manually copy from console.');
                console.log('Diagnostic Results:', text);
            }

            document.body.removeChild(textArea);
        }

        // Initialize on page load
        window.addEventListener('load', () => {
            detectBrowserEnvironment();
            runDiagnostics();
        });

        // Add global console commands for debugging
        window.testNodeAPIFromConsole = async function () {
            console.log('üîç Testing Node API connectivity...');

            const endpoints = [
                'https://node.perfectobd.com/api/node/get-home-web',
                'https://node.perfectobd.com/api/node/brand',
                'https://node.perfectobd.com/api/node/color',
                'https://node.perfectobd.com/api/node/get-available-offers'
            ];

            let results = [];

            for (const endpoint of endpoints) {
                try {
                    const response = await fetch(endpoint, {
                        method: 'GET',
                        timeout: 8000,
                        signal: AbortSignal.timeout(8000)
                    });

                    const result = {
                        endpoint: endpoint.split('/').pop(),
                        status: response.ok ? 'SUCCESS' : `FAILED (${response.status})`,
                        ok: response.ok,
                        url: endpoint
                    };
                    results.push(result);
                    console.log(`${result.ok ? '‚úÖ' : '‚ùå'} ${result.endpoint}: ${result.status}`);
                } catch (error) {
                    const result = {
                        endpoint: endpoint.split('/').pop(),
                        status: `FAILED: ${error.message}`,
                        ok: false,
                        error: error.message,
                        url: endpoint
                    };
                    results.push(result);
                    console.log(`‚ùå ${result.endpoint}: ${result.status}`);
                }
            }

            const failedCount = results.filter(r => !r.ok).length;
            const successCount = results.filter(r => r.ok).length;

            console.log('\nüìä Node API Test Summary:');
            console.log(`‚úÖ Successful: ${successCount}/${results.length}`);
            console.log(`‚ùå Failed: ${failedCount}/${results.length}`);

            if (failedCount > 0) {
                console.log('\n‚ö†Ô∏è ISSUE DETECTED:');
                console.log('Facebook iOS browser is blocking Node API calls.');
                console.log('This is the root cause of the white screen issue.');
                console.log('\nüõ†Ô∏è SOLUTIONS:');
                console.log('1. Use "Open in Browser" to open in Safari/Chrome');
                console.log('2. The app now has fallback mechanisms for graceful degradation');
                console.log('3. Visit /diagnostics or /debug.html for detailed analysis');
            } else {
                console.log('\n‚úÖ ALL TESTS PASSED:');
                console.log('Node API is accessible. The white screen issue may be intermittent.');
            }

            return results;
        };

        window.goToDiagnostics = function () {
            if (window.location.pathname.includes('debug.html')) {
                console.log('Already on diagnostic page!');
                return;
            }

            // Try React route first, fall back to debug.html
            try {
                window.location.href = '/diagnostics';
            } catch (e) {
                window.location.href = '/debug.html';
            }
        };

        // Automatically expose diagnostic functions
        console.log('üîß Perfecto Debug Commands Available:');
        console.log('üìû testNodeAPIFromConsole() - Test Node API connectivity');
        console.log('üîç goToDiagnostics() - Navigate to diagnostic page');
        console.log('üßπ cleanupServiceWorkersFromConsole() - Clean up service workers');
        console.log('üîç checkServiceWorkerHealthFromConsole() - Check service worker status');
        console.log('üî• checkFirebaseStatusFromConsole() - Check Firebase initialization status');
        console.log('üìã Type these commands to run diagnostics from console');

        // Add service worker management functions
        window.cleanupServiceWorkersFromConsole = async function () {
            console.log('üßπ Cleaning up service workers...');

            const isFacebookBrowser = /FBAN|FBAV|Instagram|FB_IAB|FB4A|FBIOS|FBANDROID/.test(navigator.userAgent);
            const isIOS = /iPad|iPhone|iPod/.test(navigator.userAgent);

            if (!isFacebookBrowser || !isIOS) {
                console.log('‚ÑπÔ∏è Not in Facebook iOS browser - cleanup may not be necessary');
            }

            let cleanedSW = 0;
            let cleanedCaches = 0;

            // Clean service workers
            if ('serviceWorker' in navigator) {
                try {
                    const registrations = await navigator.serviceWorker.getRegistrations();
                    console.log(`Found ${registrations.length} service worker registrations`);

                    for (const registration of registrations) {
                        console.log(`üóëÔ∏è Unregistering: ${registration.scope}`);
                        const success = await registration.unregister();
                        if (success) {
                            cleanedSW++;
                            console.log(`‚úÖ Unregistered: ${registration.scope}`);
                        }
                    }
                } catch (error) {
                    console.error('‚ùå Service worker cleanup failed:', error);
                }
            }

            // Clean caches
            if ('caches' in window) {
                try {
                    const cacheNames = await caches.keys();
                    console.log(`Found ${cacheNames.length} caches`);

                    for (const cacheName of cacheNames) {
                        console.log(`üóëÔ∏è Clearing cache: ${cacheName}`);
                        const success = await caches.delete(cacheName);
                        if (success) {
                            cleanedCaches++;
                            console.log(`‚úÖ Cleared cache: ${cacheName}`);
                        }
                    }
                } catch (error) {
                    console.error('‚ùå Cache cleanup failed:', error);
                }
            }

            console.log(`\nüìä Cleanup Summary:`);
            console.log(`üßπ Service Workers Cleaned: ${cleanedSW}`);
            console.log(`üóëÔ∏è Caches Cleared: ${cleanedCaches}`);
            console.log(`\nüí° Recommendation: Refresh the page after cleanup`);

            return { serviceWorkers: cleanedSW, caches: cleanedCaches };
        };

        window.checkServiceWorkerHealthFromConsole = async function () {
            console.log('üîç Checking service worker health...');

            const health = {
                supported: 'serviceWorker' in navigator,
                registrations: 0,
                active: false,
                controller: null,
                caches: 0,
                issues: []
            };

            if (!health.supported) {
                console.log('‚ùå Service workers not supported');
                return health;
            }

            // Check registrations
            try {
                const registrations = await navigator.serviceWorker.getRegistrations();
                health.registrations = registrations.length;
                health.active = registrations.some(reg => reg.active);

                console.log(`üìù Service Worker Registrations: ${health.registrations}`);
                registrations.forEach((reg, index) => {
                    console.log(`  ${index + 1}. ${reg.scope} (${reg.active ? 'active' : 'inactive'})`);
                });

                // Check for problematic Firebase service worker
                const firebaseReg = registrations.find(reg =>
                    reg.scope.includes('firebase-messaging-sw.js') ||
                    (reg.active && reg.active.scriptURL.includes('firebase-messaging-sw.js'))
                );

                if (firebaseReg) {
                    health.issues.push('Firebase messaging service worker detected - may cause issues in Facebook browser');
                    console.warn('‚ö†Ô∏è Firebase service worker found - this may cause white screen issues');
                }

            } catch (error) {
                health.issues.push(`Failed to check registrations: ${error.message}`);
                console.error('‚ùå Registration check failed:', error);
            }

            // Check controller
            if (navigator.serviceWorker.controller) {
                health.controller = navigator.serviceWorker.controller.scriptURL;
                console.log(`üéÆ Active Controller: ${health.controller}`);
            } else {
                console.log('‚ÑπÔ∏è No active service worker controller');
            }

            // Check caches
            if ('caches' in window) {
                try {
                    const cacheNames = await caches.keys();
                    health.caches = cacheNames.length;
                    console.log(`üíæ Caches: ${health.caches}`);
                    cacheNames.forEach(cache => console.log(`  - ${cache}`));
                } catch (error) {
                    health.issues.push(`Failed to check caches: ${error.message}`);
                }
            }

            // Facebook browser specific checks
            const isFacebookBrowser = /FBAN|FBAV|Instagram|FB_IAB|FB4A|FBIOS|FBANDROID/.test(navigator.userAgent);
            const isIOS = /iPad|iPhone|iPod/.test(navigator.userAgent);

            if (isFacebookBrowser && isIOS) {
                console.log('‚ö†Ô∏è Facebook iOS browser detected');
                if (health.registrations > 0) {
                    health.issues.push('Service workers active in Facebook iOS browser - may cause white screen');
                    console.warn('‚ö†Ô∏è Service workers may cause issues in Facebook iOS browser');
                    console.log('üí° Run cleanupServiceWorkersFromConsole() to fix');
                }
            }

            // Summary
            console.log('\nüìä Health Summary:');
            console.log(`‚úÖ Supported: ${health.supported}`);
            console.log(`üìù Registrations: ${health.registrations}`);
            console.log(`üî¥ Active: ${health.active}`);
            console.log(`üéÆ Controller: ${health.controller ? 'Yes' : 'No'}`);
            console.log(`üíæ Caches: ${health.caches}`);
            console.log(`‚ö†Ô∏è Issues: ${health.issues.length}`);

            if (health.issues.length > 0) {
                console.log('\n‚ö†Ô∏è Issues Found:');
                health.issues.forEach((issue, index) => {
                    console.log(`  ${index + 1}. ${issue}`);
                });
            }

            return health;
        };

        // Add Firebase status checking
        window.checkFirebaseStatusFromConsole = function () {
            console.log('üî• Checking Firebase status...');

            const isInAppBrowser = /FBAN|FBAV|Instagram|FB_IAB|FB4A|FBIOS|FBANDROID|Line|Twitter|WeChat|WhatsApp/.test(navigator.userAgent);
            const isFacebookBrowser = /FBAN|FBAV|Instagram|FB_IAB|FB4A|FBIOS|FBANDROID/.test(navigator.userAgent);
            const isIOS = /iPad|iPhone|iPod/.test(navigator.userAgent);

            console.log(`üì± Browser Environment:`);
            console.log(`  ‚Ä¢ In-app browser: ${isInAppBrowser ? 'YES' : 'NO'}`);
            console.log(`  ‚Ä¢ Facebook browser: ${isFacebookBrowser ? 'YES' : 'NO'}`);
            console.log(`  ‚Ä¢ iOS device: ${isIOS ? 'YES' : 'NO'}`);
            console.log(`  ‚Ä¢ Facebook iOS: ${isFacebookBrowser && isIOS ? 'YES (PROBLEMATIC)' : 'NO'}`);

            // Check if checkFirebaseStatus is available (from firebase config)
            if (typeof window.checkFirebaseStatus === 'function') {
                console.log(`\nüî• Firebase Status (from config):`);
                const status = window.checkFirebaseStatus();
                console.log(`  ‚Ä¢ App Available: ${status.firebaseAvailable ? 'YES' : 'NO'}`);
                console.log(`  ‚Ä¢ Messaging Available: ${status.messagingAvailable ? 'YES' : 'NO'}`);
            } else {
                console.log(`\nüî• Firebase Status: Configuration not loaded or failed`);
            }

            // Check for Firebase global objects
            console.log(`\nüåê Firebase Globals:`);
            console.log(`  ‚Ä¢ window.firebase: ${typeof window.firebase !== 'undefined' ? 'Available' : 'Not Available'}`);

            // Try to detect Firebase errors
            const errors = [];

            if (isInAppBrowser) {
                errors.push('In-app browser detected - Firebase may have limitations');
            }

            if (isFacebookBrowser && isIOS) {
                errors.push('Facebook iOS browser - Firebase initialization likely to fail');
            }

            if (typeof window.checkFirebaseStatus === 'function') {
                const status = window.checkFirebaseStatus();
                if (!status.firebaseAvailable) {
                    errors.push('Firebase app failed to initialize');
                }
                if (!status.messagingAvailable) {
                    errors.push('Firebase messaging failed to initialize');
                }
            }

            console.log(`\n‚ö†Ô∏è Issues Found: ${errors.length}`);
            if (errors.length > 0) {
                errors.forEach((error, index) => {
                    console.log(`  ${index + 1}. ${error}`);
                });

                console.log(`\nüí° Recommendations:`);
                if (isFacebookBrowser && isIOS) {
                    console.log('  ‚Ä¢ Use "Open in Browser" for full functionality');
                    console.log('  ‚Ä¢ Firebase messaging will be disabled automatically');
                    console.log('  ‚Ä¢ App should still work without push notifications');
                }
                if (errors.some(e => e.includes('service worker'))) {
                    console.log('  ‚Ä¢ Run cleanupServiceWorkersFromConsole() to fix service worker issues');
                }
            } else {
                console.log('  ‚úÖ No issues detected with Firebase');
            }

            return {
                isInApp: isInAppBrowser,
                isFacebookIOS: isFacebookBrowser && isIOS,
                errors: errors
            };
        };
    </script>
</body>

</html>